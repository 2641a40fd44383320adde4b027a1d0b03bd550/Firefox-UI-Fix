@use "sass:list";
@use "sass:map";
@use "list" as list-utils;
@use "media";

$win:    "win";
$mac:    "mac";
$linux:  "linux";

$win7:   "win7";
$win8:   "win8";
$win10:  "win10";
$bigsur: "bigsur";

$_win-template: "-moz-os-version: windows-";
$_win-media: (
  #{$win7}: $_win-template + "win7",
  #{$win8}: $_win-template + "win8",
  #{$win10}: $_win-template + "win10",
);
$_others-media: (
  #{$linux}: "-moz-gtk-csd-available",
  #{$bigsur}: "-moz-mac-big-sur-theme: 0",
);
$_os-media: map.merge(
  $_win-media, $_others-media
);

@mixin OS($osNames...) {
  @if list.index($osNames, $win) {
    $osNames: list-utils.remove($osNames, $win);
    $osNames: list.join($osNames, map.keys($_win-media));
  }

  $osMedias: ();
  @each $osName in $osNames {
    $osMedia: map.get($_os-media, $osName);
    @if $osMedia != null {
      $osMedias: list.append($osMedias, $osMedia);
    }
  }

  @include media.each($osMedias) {
    @content;
  }

  @if list.index($osNames, $mac) {
    @supports -moz-bool-pref("layout.css.osx-font-smoothing.enabled") {
      @content;
    }
  }
}
